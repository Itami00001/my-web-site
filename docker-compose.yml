version: '3.8'
services:
  web:
    build: .
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
    # –ù–ï–¢ volumes - –∑–Ω–∞—á–∏—Ç –Ω–µ—Ç –∞–≤—Ç–æ-–ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏
    command: npm start

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (docker-compose run --rm db-backup)
  db-backup:
    image: postgres:15
    volumes:
      - ./backups:/backups
    environment:
      - PGHOST=host.docker.internal
      - PGDATABASE=pickadrive
      - PGUSER=postgres
      - PGPASSWORD=1
    command: |
      sh -c '
        echo "üîÑ –ù–∞—á–∏–Ω–∞–µ–º –±—ç–∫–∞–ø –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö..."
        pg_dump -Fc pickadrive > /backups/backup_$(date +%Y-%m-%d_%H-%M-%S).dump
        echo "‚úÖ –ë—ç–∫–∞–ø —Å–æ–∑–¥–∞–Ω!"
        exit 0
      '
    restart: "no"  # –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ